<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMS Barcode Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(12, 81, 132, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #be2033 0%, #0c5184 100%);
            color: white;
            padding: 60px 20px 30px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px 20px;
            background: #ffffff;
        }

        .login-section {
            display: none;
        }

        .scanner-section {
            display: block;
        }

        .report-section {
            display: none;
        }

        .tab-container {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e8f0f7;
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #0c5184;
            border-bottom-color: #0c5184;
            background: #ffffff;
        }

        .tab-button:hover {
            background: #e8f0f7;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .report-summary {
            background: #e8f0f7;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #0c5184;
        }

        .report-summary h3 {
            color: #0c5184;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .report-summary .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .report-summary .summary-item:last-child {
            margin-bottom: 0;
        }

        .report-summary .summary-label {
            font-weight: 600;
            color: #0c5184;
        }

        .report-summary .summary-value {
            color: #333;
        }

        .report-details {
            margin-top: 20px;
        }

        .report-details h4 {
            color: #0c5184;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .report-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #0c5184;
        }

        .report-item .item-barcode {
            font-weight: 600;
            font-size: 16px;
            color: #0c5184;
            margin-bottom: 5px;
        }

        .report-item .item-details {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .report-item .item-time {
            font-size: 12px;
            color: #999;
        }

        .report-item .item-notes {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
            background: #e8f0f7;
            padding: 4px 6px;
            border-radius: 4px;
            border-left: 3px solid #0c5184;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-style: italic;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #0c5184;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e8f0f7;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
            background: #ffffff;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #0c5184;
            box-shadow: 0 0 0 3px rgba(12, 81, 132, 0.1);
        }

        .form-group input:disabled, .form-group select:disabled, .form-group textarea:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0c5184 0%, #1a6ba8 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(12, 81, 132, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #0c5184;
            border: 2px solid #e8f0f7;
        }

        .btn-secondary:hover {
            background: #e8f0f7;
            border-color: #0c5184;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        /* Status container ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà */
        .status-container {
            min-height: 80px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            position: relative;
        }

        .status-container .status {
            margin: 0;
            width: 100%;
            animation: fadeIn 0.3s ease-in;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
        .status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
            box-shadow: 0 2px 8px rgba(21, 87, 36, 0.1);
        }

        .status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
            box-shadow: 0 2px 8px rgba(114, 28, 36, 0.1);
        }

        .status.info {
            background: linear-gradient(135deg, #e8f0f7 0%, #d1e7f0 100%);
            color: #0c5184;
            border: 1px solid #d1e7f0;
            box-shadow: 0 2px 8px rgba(12, 81, 132, 0.1);
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå pulse ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà */
        .status.new-scan {
            animation: pulse 0.6s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå shimmer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• */
        .status.processing {
            background: linear-gradient(90deg, #f8f9fa 25%, #e8f0f7 50%, #f8f9fa 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }



        .today-summary {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .today-summary-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #0c5184;
        }

        .today-summary-content {
            background: linear-gradient(135deg, #e8f0f7 0%, #f1f8ff 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #0c5184;
            box-shadow: 0 4px 15px rgba(12, 81, 132, 0.1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(12, 81, 132, 0.1);
        }

        .summary-row:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-top: 12px;
            border-top: 2px solid rgba(12, 81, 132, 0.2);
        }

        .summary-label {
            font-weight: 600;
            color: #0c5184;
            font-size: 14px;
        }

        .summary-value {
            color: #333;
            font-size: 14px;
        }

        .summary-count {
            background: linear-gradient(135deg, #0c5184 0%, #1a6ba8 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 3px 10px rgba(12, 81, 132, 0.3);
            transition: all 0.3s ease;
        }

        .summary-count.updated {
            animation: countUpdate 0.6s ease-out;
        }

        @keyframes countUpdate {
            0% {
                transform: scale(1);
                background: linear-gradient(135deg, #0c5184 0%, #1a6ba8 100%);
            }
            50% {
                transform: scale(1.2);
                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                box-shadow: 0 0 15px rgba(40, 167, 69, 0.5);
            }
            100% {
                transform: scale(1);
                background: linear-gradient(135deg, #0c5184 0%, #1a6ba8 100%);
                box-shadow: 0 3px 10px rgba(12, 81, 132, 0.3);
            }
        }

        .summary-note {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 10px;
            text-align: center;
            background: rgba(255, 255, 255, 0.7);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(12, 81, 132, 0.1);
        }

        .history-section {
            margin-top: 30px;
        }

        .history-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #0c5184;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #0c5184;
            opacity: 0;
            transform: translateY(-20px);
            animation: slideInFromTop 0.5s ease-out forwards;
        }

        .history-item.new {
            border-left-color: #28a745;
            background: #e8f5e8;
            animation: slideInFromTop 0.5s ease-out forwards, highlightNew 2s ease-out 0.5s forwards;
        }

        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes highlightNew {
            0% {
                background: #d4edda;
                border-left-color: #28a745;
                box-shadow: 0 0 10px rgba(40, 167, 69, 0.3);
            }
            100% {
                background: #e8f5e8;
                border-left-color: #28a745;
                box-shadow: none;
            }
        }

        .history-barcode {
            font-weight: 600;
            font-size: 16px;
            color: #0c5184;
        }

        .history-details {
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }

        .history-time {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .history-note {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
            background: #e8f0f7;
            padding: 4px 6px;
            border-radius: 4px;
            border-left: 3px solid #0c5184;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .history-user {
            font-size: 12px;
            color: #0c5184;
            margin-top: 5px;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0c5184;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏© */
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .text-danger {
            color: #be2033;
        }

        .text-primary {
            color: #0c5184;
        }

        .text-white {
            color: #ffffff;
        }

        /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° */
        .bg-light-blue {
            background: #e8f0f7;
        }

        .bg-light-red {
            background: #f8d7da;
        }

        .bg-white {
            background: #ffffff;
        }


        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .header-right {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            align-items: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-info {
            margin-right: 15px;
        }

        .logout-btn {
            background: none;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s;
        }

        /* Responsive for small mobile screens */
        @media (max-width: 480px) {
            body {
                padding: 12px;
                font-size: 18px;
            }

            .container {
                max-width: 100%;
                border-radius: 12px;
                box-shadow: 0 10px 20px rgba(12, 81, 132, 0.12);
            }

            .header {
                padding: 40px 16px 20px 16px;
            }

            .header h1 {
                font-size: 22px;
            }

            .header p {
                font-size: 16px;
            }

            .header-right {
                top: 10px;
                right: 10px;
                font-size: 12px;
                padding: 6px 10px;
            }

            .content {
                padding: 20px 16px;
            }

            .tab-button {
                padding: 14px;
                font-size: 18px;
            }

            .form-group label {
                font-size: 16px;
            }

            .form-group input, .form-group select, .form-group textarea {
                padding: 16px;
                font-size: 18px;
            }

            .btn {
                padding: 16px;
                font-size: 18px;
            }

            .today-summary-title,
            .history-title,
            .report-summary h3,
            .report-details h4 {
                font-size: 18px;
            }

            .summary-label,
            .summary-value {
                font-size: 16px;
            }

            .summary-count {
                font-size: 20px;
            }

            .report-item .item-barcode,
            .history-barcode {
                font-size: 18px;
            }

            .report-item .item-details,
            .history-details {
                font-size: 16px;
            }

            .report-item .item-time,
            .history-time,
            .summary-note {
                font-size: 14px;
            }

            .report-item .item-notes,
            .history-note {
                font-size: 14px;
            }
        }

        /* ===== Notification Popup Styles ===== */
        /* Modal Notification */
        .modal-notification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-notification-content {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            border: 3px solid;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-notification-content.success { border-color: #28a745; }
        .modal-notification-content.error { border-color: #dc3545; }
        .modal-notification-content.warning { border-color: #ffc107; }
        .modal-notification-content.duplicate { border-color: #ffc107; }

        .modal-notification-icon {
            font-size: 48px;
            display: block;
            text-align: center;
            margin-bottom: 15px;
        }

        .modal-notification-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-notification-message {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: center;
            white-space: pre-wrap;
        }

        .modal-notification-close-btn {
            display: block;
            width: 100%;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .modal-notification-content.success .modal-notification-close-btn { background-color: #28a745; }
        .modal-notification-content.error .modal-notification-close-btn { background-color: #dc3545; }
        .modal-notification-content.warning .modal-notification-close-btn,
        .modal-notification-content.duplicate .modal-notification-close-btn { background-color: #ffc107; color: #212529; }

        .modal-notification-close-btn:hover {
            opacity: 0.9;
        }

        /* Toast Notification */
        #toast-notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9998;
            display: flex;
            flex-direction: column-reverse;
            gap: 10px;
        }

        .toast-notification {
            background-color: white;
            border-radius: 8px;
            padding: 16px 20px;
            min-width: 350px;
            max-width: 450px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.3s ease-out;
            position: relative;
            border-left: 4px solid;
        }

        @keyframes slideInRight {
            from { transform: translateX(450px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(450px); opacity: 0; }
        }

        .toast-notification.success { border-left-color: #28a745; }
        .toast-notification.error { border-left-color: #dc3545; }
        .toast-notification.warning { border-left-color: #ffc107; }
        .toast-notification.duplicate { border-left-color: #ffc107; }

        .toast-notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .toast-notification-icon-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast-notification-icon {
            font-size: 24px;
        }

        .toast-notification-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0;
        }

        .toast-notification-close {
            font-size: 24px;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
        }

        .toast-notification-close:hover {
            opacity: 1;
        }

        .toast-notification-message {
            font-size: 14px;
            line-height: 1.4;
            color: #555;
            margin: 0;
        }

        .toast-notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 0 0 0 8px;
        }

    </style>
</head>
<body>
    <!-- Audio elements for sounds (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö fallback ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) -->
    <audio id="successSound" src="/static/sounds/success.mp3" preload="auto"></audio>
    <audio id="errorSound" src="/static/sounds/error.mp3" preload="auto"></audio>
    <audio id="duplicateSound" src="/static/sounds/duplicate.mp3" preload="auto"></audio>
    <audio id="warningSound" src="/static/sounds/warning.mp3" preload="auto"></audio>
    
    <div class="container">
        <div class="header">
            <div class="header-right">
                <div class="user-info" id="userInfo"></div>
                <button class="logout-btn" onclick="logoutUser()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
            <h1>üè¢ WMS EP Asia Group</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£</p>
        </div>

        <div class="content">
            <!-- Tab Container -->
            <div class="tab-container">
                <button class="tab-button active" onclick="switchTab('scanner')">üì± Scan</button>
                <button class="tab-button" onclick="switchTab('report')">üìä Report</button>
            </div>

            <!-- Scanner Tab -->
            <div id="scannerTab" class="tab-content active">
                <div id="scannerSection" class="scanner-section">
                    <div style="margin-bottom: 20px;"></div>
                
                
                <div class="form-group">
                    <label for="jobType">Job Type:</label>
                    <select id="jobType" onchange="loadSubJobTypes()">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subJobType">Sub Job Type:</label>
                    <select id="subJobType" disabled onchange="checkSubJobTypeSelection()">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</label>
                    <textarea id="note" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." rows="2" style="resize: none;" onkeydown="handleNoteKeydown(event)" oninput="handleNoteInput()"></textarea>
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô 
                    </small>
                </div>

                <div class="form-group">
                    <label for="barcode">Barcode:</label>
                    <input type="text" id="barcode" placeholder="‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î" onkeypress="handleBarcodeEnter(event)">
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        üí° ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô
                    </small>
                </div>
                
                <div class="status-container">
                    <div id="scanStatus"></div>
                </div>

                <!-- Today Summary Section -->
                <div id="todaySummary" class="today-summary" style="display: none;">
                    <div class="today-summary-title">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    <div id="todaySummaryContent" class="today-summary-content"></div>
                </div>

                <!-- History Section -->
                <div class="history-section" style="display: none;">
                    <div class="history-title">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                    <div id="historyList"></div>
                </div>
            </div>
            </div>

            <!-- Report Tab -->
            <div id="reportTab" class="tab-content">
                <div class="form-group">
                    <div style="margin-bottom: 20px;"></div>

                    <label for="reportDate">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="date" id="reportDate" required>
                </div>

                <div class="form-group">
                    <label for="reportJobType">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å:</label>
                    <select id="reportJobType" onchange="loadReportSubJobTypes()">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="reportSubJobType">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á:</label>
                    <select id="reportSubJobType" disabled>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="reportNoteFilter">‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</label>
                    <input type="text" id="reportNoteFilter" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        üí° ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á
                    </small>
                </div>

                <button class="btn btn-primary" onclick="generateReport()">üìä ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>

                <div id="reportStatus"></div>

                <!-- Report Summary -->
                <div id="reportSummary" class="report-summary" style="display: none;">
                    <h3>üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</h3>
                    <div id="summaryContent"></div>
                </div>

                <!-- Report Details -->
                <div id="reportDetails" class="report-details" style="display: none;">
                    <h4>üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h4>
                    <div id="detailsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isConnected = true;
        
        // Global cache for job types and sub job types
        let jobTypesCache = [];
        let subJobTypesCache = {};
        
        // Audio management system
        let audioManager = {
            currentAudio: null,
            audioQueue: [],
            isPlaying: false,
            soundSettings: {},
            soundEnabled: true,

            /**
             * ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å sound object ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å SoundService
             * @param {Object} soundObj - object ‡∏ó‡∏µ‡πà‡∏°‡∏µ sound_file, volume, is_enabled
             */
            playSound: function(soundObj) {
                if (!soundObj || !soundObj.sound_file || !soundObj.is_enabled || !this.soundEnabled) {
                    return;
                }

                // Stop any currently playing audio
                if (this.currentAudio && !this.currentAudio.paused) {
                    this.currentAudio.pause();
                    this.currentAudio.currentTime = 0;
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á audio element ‡πÉ‡∏´‡∏°‡πà
                this.currentAudio = new Audio(soundObj.sound_file);
                this.currentAudio.volume = soundObj.volume || 0.8;
                this.currentAudio.play().catch(e => {
                    console.warn('Audio play failed:', e);
                });
            },

            /**
             * ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å path ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (backward compatible)
             * @param {string} soundPath - path ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á
             * @param {number} volume - ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á (0.0-1.0)
             */
            playSoundFile: function(soundPath, volume = 0.8) {
                if (!this.soundEnabled) return;

                // Stop any currently playing audio
                if (this.currentAudio && !this.currentAudio.paused) {
                    this.currentAudio.pause();
                    this.currentAudio.currentTime = 0;
                }

                this.currentAudio = new Audio(soundPath);
                this.currentAudio.volume = volume;
                this.currentAudio.play().catch(e => {
                    console.warn('Audio play failed:', e);
                });
            },

            /**
             * ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á error (fallback ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ sound object ‡∏à‡∏≤‡∏Å backend)
             */
            playErrorSound: function() {
                // ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á error ‡∏à‡∏≤‡∏Å audio element
                const audioElement = document.getElementById('errorSound');

                if (audioElement) {
                    // Stop any currently playing audio
                    if (this.currentAudio && !this.currentAudio.paused) {
                        this.currentAudio.pause();
                        this.currentAudio.currentTime = 0;
                    }

                    this.currentAudio = audioElement;
                    this.currentAudio.currentTime = 0;
                    this.currentAudio.play().catch(e => {
                        console.warn('Audio play failed:', e);
                    });
                }
            },

            /**
             * ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á success
             * @param {Object} soundObj - sound object ‡∏à‡∏≤‡∏Å SoundService
             */
            playSuccessSound: function(soundObj) {
                this.playSound(soundObj);
            },

            /**
             * ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á duplicate
             * @param {Object} soundObj - sound object ‡∏à‡∏≤‡∏Å SoundService
             */
            playDuplicateSound: function(soundObj) {
                this.playSound(soundObj);
            },

            /**
             * ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
             * @param {boolean} enabled - true = ‡πÄ‡∏õ‡∏¥‡∏î, false = ‡∏õ‡∏¥‡∏î
             */
            setSoundEnabled: function(enabled) {
                this.soundEnabled = enabled;
                if (!enabled && this.currentAudio && !this.currentAudio.paused) {
                    this.currentAudio.pause();
                }
            }
        };
        
        // Status persistence system
        let statusManager = {
            lastScanResult: null,
            
            saveScanResult: function(barcode, result, message, type) {
                this.lastScanResult = {
                    barcode: barcode,
                    result: result,
                    message: message,
                    type: type,
                    timestamp: new Date()
                };
            },
            
            getLastScanDisplay: function() {
                if (!this.lastScanResult) {
                    return null;
                }
                
                const statusIcon = this.lastScanResult.type === 'success' ? '‚úÖ' : '‚ùå';
                const statusColor = this.lastScanResult.type === 'success' ? '#155724' : '#721c24';
                const statusBg = this.lastScanResult.type === 'success' ? '#d4edda' : '#f8d7da';
                const statusBorder = this.lastScanResult.type === 'success' ? '#c3e6cb' : '#f5c6cb';
                
                return {
                    html: `<div class="status ${this.lastScanResult.type}" style="background: ${statusBg}; color: ${statusColor}; border: 1px solid ${statusBorder};">
                        <div>
                            <strong>${statusIcon} ${this.lastScanResult.barcode}</strong><br>
                            <small>${this.lastScanResult.message}</small>
                        </div>
                    </div>`,
                    type: this.lastScanResult.type
                };
            },
            

        };

        // Load job types with caching
        async function loadJobTypes() {
            // Use cache if available
            if (jobTypesCache.length > 0) {
                populateJobTypeSelect('jobType', jobTypesCache);
                return jobTypesCache;
            }

            try {
                const response = await fetch('/api/job_types');
                const data = await response.json();

                if (data.success) {
                    // Store in cache
                    jobTypesCache = data.data;
                    
                    // Populate select elements
                    populateJobTypeSelect('jobType', jobTypesCache);
                }
                return jobTypesCache;
            } catch (error) {
                console.error('Error loading job types:', error);
                return [];
            }
        }

        // Helper function to populate job type select
        function populateJobTypeSelect(selectId, jobTypes) {
            const jobTypeSelect = document.getElementById(selectId);
            if (!jobTypeSelect) return;
            
            jobTypeSelect.innerHTML = selectId === 'reportJobType' ? 
                '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å</option>' : 
                '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type</option>';
            
            jobTypes.forEach(jobType => {
                const option = document.createElement('option');
                option.value = jobType.id;
                option.textContent = jobType.name;
                jobTypeSelect.appendChild(option);
            });
        }

        // Check sub job type selection
        function checkSubJobTypeSelection() {
            const subJobTypeId = document.getElementById('subJobType').value;
            const barcodeInput = document.getElementById('barcode');
            const noteTextarea = document.getElementById('note');
            
            if (!subJobTypeId) {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                barcodeInput.disabled = true;
                barcodeInput.placeholder = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type ‡∏Å‡πà‡∏≠‡∏ô';
                noteTextarea.disabled = true;
                noteTextarea.placeholder = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type ‡∏Å‡πà‡∏≠‡∏ô';
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                barcodeInput.disabled = false;
                barcodeInput.placeholder = '‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î';
                noteTextarea.disabled = false;
                noteTextarea.placeholder = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏...';
            }
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Sub Job Type
            batchDataUpdate();
        }

        // Load sub job types with caching
        async function loadSubJobTypes() {
            const jobTypeId = document.getElementById('jobType').value;
            const subJobTypeSelect = document.getElementById('subJobType');
            const barcodeInput = document.getElementById('barcode');
            const noteTextarea = document.getElementById('note');
            
            if (!jobTypeId) {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Sub Job Type ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                subJobTypeSelect.disabled = true;
                subJobTypeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type</option>';
                barcodeInput.disabled = true;
                barcodeInput.placeholder = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type ‡∏Å‡πà‡∏≠‡∏ô';
                noteTextarea.disabled = true;
                noteTextarea.placeholder = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type ‡∏Å‡πà‡∏≠‡∏ô';
                // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Job Type
                batchDataUpdate();
                return;
            }

            // Use cache if available
            if (subJobTypesCache[jobTypeId]) {
                populateSubJobTypeSelect('subJobType', subJobTypesCache[jobTypeId]);
                subJobTypeSelect.disabled = false;
                checkSubJobTypeSelection();
                batchDataUpdate();
                return;
            }

            try {
                const response = await fetch(`/api/sub_job_types/${jobTypeId}`);
                const data = await response.json();

                if (data.success) {
                    // Store in cache
                    subJobTypesCache[jobTypeId] = data.data;
                    
                    // Populate select
                    populateSubJobTypeSelect('subJobType', data.data);
                    subJobTypeSelect.disabled = false;
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î
                    checkSubJobTypeSelection();
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Job Type
                    batchDataUpdate();
                }
            } catch (error) {
                console.error('Error loading sub job types:', error);
                subJobTypeSelect.disabled = true;
                barcodeInput.disabled = true;
                barcodeInput.placeholder = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Sub Job Types';
                noteTextarea.disabled = true;
                noteTextarea.placeholder = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Sub Job Types';
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
                document.getElementById('todaySummary').style.display = 'none';
            }
        }

        // Helper function to populate sub job type select
        function populateSubJobTypeSelect(selectId, subJobTypes) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            select.innerHTML = selectId === 'reportSubJobType' ? 
                '<option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>' : 
                '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sub Job Type</option>';
            
            subJobTypes.forEach(subJobType => {
                const option = document.createElement('option');
                option.value = subJobType.id;
                option.textContent = subJobType.name;
                select.appendChild(option);
            });
        }

        // === Notification Manager ===
        const NotificationManager = {
            getEventIcon: function(eventType) {
                const icons = {
                    'success': '‚úì',
                    'error': '‚úó',
                    'warning': '‚ö†',
                    'duplicate': '‚ö†',
                    'info': '‚Ñπ'
                };
                return icons[eventType] || '‚Ñπ';
            },

            showModal: function(notification) {
                const overlay = document.getElementById('modal-notification');
                const content = overlay.querySelector('.modal-notification-content');
                const icon = overlay.querySelector('.modal-notification-icon');
                const title = overlay.querySelector('.modal-notification-title');
                const message = overlay.querySelector('.modal-notification-message');
                const closeBtn = overlay.querySelector('.modal-notification-close-btn');

                // Set content
                icon.textContent = this.getEventIcon(notification.event_type);

                // Build title HTML with barcode if available
                let titleHTML = '';
                if (notification.barcode) {
                    titleHTML = `<div style="font-family: 'Courier New', monospace; font-size: 14px; margin-bottom: 8px;">Barcode: ${notification.barcode}</div>`;
                }
                titleHTML += notification.title;
                title.innerHTML = titleHTML;

                message.textContent = notification.message;

                // Set style based on event type
                content.className = `modal-notification-content ${notification.event_type}`;

                // Show modal
                overlay.style.display = 'flex';

                // Close button handler
                const closeHandler = () => {
                    overlay.style.display = 'none';
                    closeBtn.removeEventListener('click', closeHandler);
                    overlay.removeEventListener('click', overlayClickHandler);
                };

                // Click overlay to close
                const overlayClickHandler = (e) => {
                    if (e.target === overlay) {
                        closeHandler();
                    }
                };

                closeBtn.addEventListener('click', closeHandler);
                overlay.addEventListener('click', overlayClickHandler);

                // ESC key to close
                const escHandler = (e) => {
                    if (e.key === 'Escape') {
                        closeHandler();
                        document.removeEventListener('keydown', escHandler);
                    }
                };
                document.addEventListener('keydown', escHandler);
            },

            showToast: function(notification, duration = 5000) {
                const container = document.getElementById('toast-notification-container');
                const toast = document.createElement('div');
                toast.className = `toast-notification ${notification.event_type}`;

                // Build barcode and title HTML
                let titleSectionHTML = '';
                if (notification.barcode) {
                    titleSectionHTML = `
                        <div>
                            <div style="font-family: 'Courier New', monospace; font-size: 11px; margin-bottom: 3px; font-weight: bold;">Barcode: ${notification.barcode}</div>
                            <h4 class="toast-notification-title" style="margin: 0;">${notification.title}</h4>
                        </div>
                    `;
                } else {
                    titleSectionHTML = `<h4 class="toast-notification-title">${notification.title}</h4>`;
                }

                // Create toast HTML
                toast.innerHTML = `
                    <div class="toast-notification-header">
                        <div class="toast-notification-icon-title">
                            <span class="toast-notification-icon">${this.getEventIcon(notification.event_type)}</span>
                            ${titleSectionHTML}
                        </div>
                    </div>
                    <p class="toast-notification-message">${notification.message}</p>
                    <div class="toast-notification-progress"></div>
                `;

                container.appendChild(toast);

                const progressBar = toast.querySelector('.toast-notification-progress');

                // Progress animation
                if (duration > 0) {
                    progressBar.style.width = '100%';
                    progressBar.style.transition = `width ${duration}ms linear`;
                    setTimeout(() => {
                        progressBar.style.width = '0%';
                    }, 10);
                }

                // Close toast function
                const closeToast = () => {
                    toast.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                };

                // Click to close
                toast.addEventListener('click', closeToast);

                // Auto close
                if (duration > 0) {
                    setTimeout(closeToast, duration);
                }
            },

            show: function(notification) {
                if (notification.popup_type === 'modal') {
                    this.showModal(notification);
                } else {
                    this.showToast(notification);
                }
            }
        };

        // Scan barcode - ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Desktop App
        async function scanBarcode() {
            const barcode = document.getElementById('barcode').value.trim();
            const jobTypeId = document.getElementById('jobType').value;
            const subJobTypeId = document.getElementById('subJobType').value;
            const note = document.getElementById('note').value;

            if (!barcode) {
                showStatus('scanStatus', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î', 'error');
                return;
            }

            if (!jobTypeId) {
                showStatus('scanStatus', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type', 'error');
                return;
            }

            // Sub Job Type ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Desktop App

            try {
                const result = await fetchWithRateLimit('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        barcode,
                        job_type_id: jobTypeId,
                        sub_job_type_id: subJobTypeId,
                        note: note
                    })
                });

                if (result.isRateLimit) {
                    handleRateLimitError(result.data, 'scanStatus');
                    return;
                }

                const { response, data } = result;

                if (data.success) {
                    showStatus('scanStatus', data.message, 'success');

                    // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á success ‡∏à‡∏≤‡∏Å backend
                    if (data.sound) {
                        audioManager.playSuccessSound(data.sound);
                    }

                    document.getElementById('barcode').value = '';
                    document.getElementById('barcode').focus();

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
                    if (data.scan_data) {
                        addNewHistoryItem(data.scan_data);
                    }

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    batchDataUpdate();

                    // ‡πÅ‡∏™‡∏î‡∏á notification popup ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                    if (data.notification) {
                        NotificationManager.show(data.notification);
                    }
                } else {
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á barcode ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    document.getElementById('barcode').value = '';
                    document.getElementById('barcode').focus();

                    // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á error
                    if (data.sound) {
                        if (data.duplicate) {
                            audioManager.playDuplicateSound(data.sound);
                        } else {
                            audioManager.playSound(data.sound);
                        }
                    } else {
                        // Fallback ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ sound object ‡∏à‡∏≤‡∏Å backend
                        if (data.duplicate) {
                            // ‡πÉ‡∏ä‡πâ duplicate sound fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏ã‡πâ‡∏≥
                            const duplicateAudio = document.getElementById('duplicateSound');
                            if (duplicateAudio) {
                                duplicateAudio.currentTime = 0;
                                duplicateAudio.play().catch(e => console.warn('Duplicate sound failed:', e));
                            }
                        } else {
                            audioManager.playErrorSound();
                        }
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á notification popup ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ (‡πÅ‡∏°‡πâ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ error/duplicate)
                    if (data.notification) {
                        NotificationManager.show(data.notification);
                    }

                    if (data.duplicate) {
                        const message = `${data.message}\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°:\n‡πÄ‡∏ß‡∏•‡∏≤: ${new Date(data.existing_record.scan_date).toLocaleString('th-TH')}\nJob Type: ${data.existing_record.job_type_name}\nSub Job Type: ${data.existing_record.sub_job_type_name}\n‡∏ú‡∏π‡πâ‡∏™‡πÅ‡∏Å‡∏ô: ${data.existing_record.user_id}`;
                        // ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á error ‡∏ã‡πâ‡∏≥ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á duplicate ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
                        showStatus('scanStatus', message, 'error', { suppressSound: true });
                    } else {
                        showStatus('scanStatus', data.message, 'error');
                    }
                }
            } catch (error) {
                showStatus('scanStatus', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
            }
        }

        // Load today summary
        async function loadTodaySummary() {
            try {
                const jobTypeId = document.getElementById('jobType').value;
                const subJobTypeId = document.getElementById('subJobType').value;
                const noteFilter = document.getElementById('note').value.trim();
                
                if (!jobTypeId) {
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type
                    document.getElementById('todaySummary').style.display = 'none';
                    return;
                }
                
                let url = `/api/today_summary?job_type_id=${jobTypeId}`;
                if (subJobTypeId) {
                    url += `&sub_job_type_id=${subJobTypeId}`;
                }
                if (noteFilter) {
                    url += `&note_filter=${encodeURIComponent(noteFilter)}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success && data.data) {
                    const summaryContent = document.getElementById('todaySummaryContent');
                    const summaryData = data.data;
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    const currentCountElement = summaryContent.querySelector('.summary-count');
                    const currentCount = currentCountElement ? parseInt(currentCountElement.textContent) : 0;
                    const newCount = summaryData.total_count;
                    const isCountChanged = currentCount !== newCount;
                    
                    let noteFilterHtml = '';
                    if (summaryData.note_filter) {
                        noteFilterHtml = `
                            <div class="summary-row">
                                <span class="summary-label">‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span>
                                <span class="summary-value">"${summaryData.note_filter}"</span>
                            </div>
                        `;
                    }
                    
                    summaryContent.innerHTML = `
                        <div class="summary-row">
                            <span class="summary-label">‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å:</span>
                            <span class="summary-value">${summaryData.job_type_name}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á:</span>
                            <span class="summary-value">${summaryData.sub_job_type_name}</span>
                        </div>
                        ${noteFilterHtml}
                        <div class="summary-row">
                            <span class="summary-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</span>
                            <span class="summary-count ${isCountChanged ? 'updated' : ''}">${summaryData.total_count}</span>
                        </div>
                        <div class="summary-note">
                            üí° ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date().toLocaleString('th-TH')}
                        </div>
                    `;
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
                    if (isCountChanged && currentCountElement) {
                        const newCountElement = summaryContent.querySelector('.summary-count');
                        if (newCountElement) {
                            // ‡∏•‡∏ö class updated ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
                            setTimeout(() => {
                                newCountElement.classList.remove('updated');
                            }, 600);
                        }
                    }
                    
                    document.getElementById('todaySummary').style.display = 'block';
                } else {
                    document.getElementById('todaySummary').style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading today summary:', error);
                document.getElementById('todaySummary').style.display = 'none';
            } finally {
                loadingStates.summary = false;
            }
        }

        // Load history with filtering based on current selections
        async function loadHistory() {
            if (loadingStates.history) {
                console.log('‚è≥ History already loading, skipping...');
                return;
            }
            
            loadingStates.history = true;
            try {
                const jobTypeId = document.getElementById('jobType').value;
                const subJobTypeId = document.getElementById('subJobType').value;
                const noteFilter = document.getElementById('note').value.trim();
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type
                const historySection = document.querySelector('.history-section');
                if (!jobTypeId) {
                    historySection.style.display = 'none';
                    loadingStates.history = false;
                    return;
                }
                
                // Build URL with filters (default to today only)
                let url = '/api/history?limit=50&today_only=true';
                
                if (jobTypeId) {
                    url += `&job_id=${jobTypeId}`;
                }
                
                if (subJobTypeId) {
                    url += `&sub_job_id=${subJobTypeId}`;
                }
                
                if (noteFilter) {
                    url += `&notes_filter=${encodeURIComponent(noteFilter)}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();

                if (data.success) {
                    const historyList = document.getElementById('historyList');
                    const historySection = document.querySelector('.history-section');
                    historyList.innerHTML = '';

                    if (data.data.length === 0) {
                        historyList.innerHTML = '<div class="loading">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</div>';
                        historySection.style.display = 'none';
                        return;
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á history section ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    historySection.style.display = 'block';

                    data.data.forEach((item, index) => {
                        const historyItem = document.createElement('div');
                        historyItem.className = `history-item ${item.status === '‡πÉ‡∏´‡∏°‡πà' ? 'new' : ''}`;
                        
                        const time = new Date(item.scan_date).toLocaleString('th-TH');
                        
                        let noteHtml = '';
                        if (item.notes && item.notes.trim()) {
                            noteHtml = `<div class="history-note">üìù ${item.notes}</div>`;
                        }
                        
                        historyItem.innerHTML = `
                            <div class="history-barcode">${item.barcode}</div>
                            <div class="history-details">
                                ${item.job_type_name} > ${item.sub_job_type_name}
                            </div>
                            <div class="history-user">üë§ ${item.user_id}</div>
                            ${noteHtml}
                            <div class="history-time">${time}</div>
                        `;
                        
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏ö‡∏ö staggered (‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
                        historyItem.style.animationDelay = `${index * 0.1}s`;
                        
                        historyList.appendChild(historyItem);
                    });
                }
            } catch (error) {
                console.error('Error loading history:', error);
            } finally {
                loadingStates.history = false;
            }
        }

        // Handle barcode enter key
        function handleBarcodeEnter(event) {
            if (event.key === 'Enter') {
                // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î Shift+Enter ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏)
                if (event.shiftKey) {
                    return; // ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
                }
                event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
                scanBarcode();
            }
        }

        // Handle note textarea keydown
        function handleNoteKeydown(event) {
            if (event.key === 'Enter') {
                if (event.ctrlKey) {
                    // Ctrl+Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô
                    event.preventDefault();
                    scanBarcode();
                }
                // Enter ‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£)
            }
        }

        // Request deduplication system
        const pendingRequests = new Map();
        const requestCache = new Map();
        const CACHE_DURATION = 2000; // 2 seconds cache
        
        // Enhanced fetch with deduplication
        async function fetchWithDeduplication(url, options = {}) {
            // Check cache first
            const cacheKey = url + JSON.stringify(options);
            const cached = requestCache.get(cacheKey);
            if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {
                console.log(`üîÑ Using cached result for: ${url}`);
                return cached.result;
            }
            
            // Check if request is already pending
            if (pendingRequests.has(cacheKey)) {
                console.log(`‚è≥ Waiting for pending request: ${url}`);
                return pendingRequests.get(cacheKey);
            }
            
            // Make new request
            console.log(`üåê Making new request: ${url}`);
            const requestPromise = fetch(url, options).then(async (response) => {
                const data = await response.json();
                const result = { 
                    isRateLimit: response.status === 429, 
                    response, 
                    data 
                };
                
                // Cache the result
                requestCache.set(cacheKey, {
                    result,
                    timestamp: Date.now()
                });
                
                return result;
            }).finally(() => {
                // Remove from pending
                pendingRequests.delete(cacheKey);
            });
            
            pendingRequests.set(cacheKey, requestPromise);
            return requestPromise;
        }
        
        // Loading states
        const loadingStates = {
            history: false,
            summary: false,
            subJobTypes: false
        };
        
        // Batch update system
        let updateBatchTimeout;
        function batchDataUpdate() {
            if (updateBatchTimeout) {
                clearTimeout(updateBatchTimeout);
            }
            
            updateBatchTimeout = setTimeout(async () => {
                const promises = [];
                
                if (!loadingStates.history) {
                    promises.push(loadHistory());
                }
                if (!loadingStates.summary) {
                    promises.push(loadTodaySummary());
                }
                
                await Promise.all(promises);
            }, 300); // Reduced from 500ms
        }

        // Handle note input with batched updates
        let noteInputTimeout;
        function handleNoteInput() {
            // Clear previous timeout
            if (noteInputTimeout) {
                clearTimeout(noteInputTimeout);
            }
            
            // Set new timeout for batched update
            noteInputTimeout = setTimeout(() => {
                batchDataUpdate();
            }, 500);
        }



        // Handle rate limit error with countdown
        function handleRateLimitError(data, elementId) {
            const retryAfter = data.details?.retry_after || 60;
            showStatus(elementId, `‚è∞ ${data.message}\n\nüí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà`, 'error');
            
            // ‡πÅ‡∏™‡∏î‡∏á countdown
            let countdown = retryAfter;
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    showStatus(elementId, `‚è∞ ‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠ ${countdown} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\n\nüí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡πâ‡∏≤‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î`, 'error');
                } else {
                    clearInterval(countdownInterval);
                    showStatus(elementId, '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ', 'info');
                    setTimeout(() => {
                        document.getElementById(elementId).innerHTML = '';
                    }, 3000);
                }
            }, 1000);
        }

        // Enhanced fetch with rate limit handling - use deduplication
        async function fetchWithRateLimit(url, options = {}) {
            return fetchWithDeduplication(url, options);
        }

        // Show status message with fixed height container
        function showStatus(elementId, message, type, options = {}) {
            const element = document.getElementById(elementId);
            const { showAnimation = true, isNewScan = false, suppressSound = false } = options;
            
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö scanStatus ‡πÉ‡∏ä‡πâ status bar ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
            if (elementId === 'scanStatus') {
                const container = document.querySelector('.status-container');
                container.style.display = 'flex'; // ‡πÅ‡∏™‡∏î‡∏á container ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                
                let statusClass = type;
                if (isNewScan) {
                    statusClass += ' new-scan';
                }
                if (type === 'info' && message.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á')) {
                    statusClass += ' processing';
                }
                
                element.innerHTML = `<div class="status ${statusClass}">${message}</div>`;
                
                if (type === 'error' && !suppressSound) {
                    // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á error ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏™ duplicate ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)
                    audioManager.playErrorSound();
                }
                
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö success message ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô default)
                // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
            } else {
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö element ‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°
                let statusClass = type;
                if (isNewScan) {
                    statusClass += ' new-scan';
                }
                
                element.innerHTML = `<div class="status ${statusClass}">${message}</div>`;
                if (type === 'error') {
                    audioManager.playErrorSound();
                }
                if (type === 'success') {
                    setTimeout(() => {
                        element.innerHTML = '';
                    }, 3000);
                }
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á default status ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö scan
        function showDefaultScanStatus() {
            const element = document.getElementById('scanStatus');
            const container = document.querySelector('.status-container');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const lastScanDisplay = statusManager.getLastScanDisplay();
            
            if (lastScanDisplay) {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                element.innerHTML = lastScanDisplay.html;
                container.style.display = 'flex';
            } else {
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
                element.innerHTML = '';
                container.style.display = 'none';
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
        function addNewHistoryItem(scanData) {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!scanData) {
                console.log('No scan data provided to addNewHistoryItem');
                return;
            }
            
            const historyList = document.getElementById('historyList');
            const historySection = document.querySelector('.history-section');
            
            // ‡πÅ‡∏™‡∏î‡∏á history section ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á
            historySection.style.display = 'block';
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item new';
            
            const time = new Date(scanData.scan_date || new Date()).toLocaleString('th-TH');
            
            let noteHtml = '';
            if (scanData.notes && scanData.notes.trim()) {
                noteHtml = `<div class="history-note">üìù ${scanData.notes}</div>`;
            }
            
            historyItem.innerHTML = `
                <div class="history-barcode">${scanData.barcode || 'N/A'}</div>
                <div class="history-details">
                    ${scanData.job_type_name || 'N/A'} > ${scanData.sub_job_type_name || 'N/A'}
                </div>
                <div class="history-user">üë§ ${scanData.user_id || 'N/A'}</div>
                ${noteHtml}
                <div class="history-time">${time}</div>
            `;
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î
            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            const items = historyList.querySelectorAll('.history-item');
            if (items.length > 50) {
                historyList.removeChild(items[items.length - 1]);
            }
        }



        // Switch between tabs
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Show selected tab content
            if (tabName === 'scanner') {
                document.getElementById('scannerTab').classList.add('active');
                document.querySelector('.tab-button:first-child').classList.add('active');
            } else if (tabName === 'report') {
                document.getElementById('reportTab').classList.add('active');
                document.querySelector('.tab-button:last-child').classList.add('active');
                // Use cached job types for report (should already be loaded)
                loadReportJobTypes();
            }
        }

        // Load job types for report using cache
        async function loadReportJobTypes() {
            // Use cache if available
            if (jobTypesCache.length > 0) {
                populateJobTypeSelect('reportJobType', jobTypesCache);
                return;
            }

            // If cache is empty, load from API and cache it
            await loadJobTypes();
            populateJobTypeSelect('reportJobType', jobTypesCache);
        }

        // Load sub job types for report using cache
        async function loadReportSubJobTypes() {
            const jobTypeId = document.getElementById('reportJobType').value;
            const subJobTypeSelect = document.getElementById('reportSubJobType');
            
            if (!jobTypeId) {
                subJobTypeSelect.disabled = true;
                subJobTypeSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</option>';
                return;
            }

            // Use cache if available
            if (subJobTypesCache[jobTypeId]) {
                populateSubJobTypeSelect('reportSubJobType', subJobTypesCache[jobTypeId]);
                subJobTypeSelect.disabled = false;
                return;
            }

            try {
                const response = await fetch(`/api/sub_job_types/${jobTypeId}`);
                const data = await response.json();

                if (data.success) {
                    // Store in cache
                    subJobTypesCache[jobTypeId] = data.data;
                    
                    // Populate select
                    populateSubJobTypeSelect('reportSubJobType', data.data);
                    subJobTypeSelect.disabled = false;
                }
            } catch (error) {
                console.error('Error loading sub job types for report:', error);
                subJobTypeSelect.disabled = true;
            }
        }

        // Generate report
        async function generateReport() {
            const reportDate = document.getElementById('reportDate').value;
            const jobTypeId = document.getElementById('reportJobType').value;
            const subJobTypeId = document.getElementById('reportSubJobType').value;
            const noteFilter = document.getElementById('reportNoteFilter').value.trim();

            if (!reportDate) {
                showStatus('reportStatus', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'error');
                return;
            }

            if (!jobTypeId) {
                showStatus('reportStatus', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å', 'error');
                return;
            }

            showStatus('reportStatus', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô...', 'info');

            try {
                const requestBody = { 
                    report_date: reportDate,
                    job_type_id: jobTypeId, 
                    sub_job_type_id: subJobTypeId || null
                };

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å
                if (noteFilter) {
                    requestBody.note_filter = noteFilter;
                }

                const result = await fetchWithRateLimit('/api/report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (result.isRateLimit) {
                    handleRateLimitError(result.data, 'reportStatus');
                    return;
                }

                const { data } = result;

                if (data.success) {
                    showStatus('reportStatus', '‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    displayReport(data.summary, data.data);
                } else {
                    showStatus('reportStatus', data.message, 'error');
                }
            } catch (error) {
                showStatus('reportStatus', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'error');
            }
        }

        // Display report
        function displayReport(summary, reportData) {
            // Display summary
            const summaryContent = document.getElementById('summaryContent');
            const generatedAt = new Date(summary.generated_at).toLocaleString('th-TH');
            
            let noteFilterHtml = '';
            if (summary.note_filter) {
                noteFilterHtml = `
                    <div class="summary-item">
                        <span class="summary-label">‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span>
                        <span class="summary-value">"${summary.note_filter}"</span>
                    </div>
                `;
            }

            summaryContent.innerHTML = `
                <div class="summary-item">
                    <span class="summary-label">‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å:</span>
                    <span class="summary-value">${summary.job_type_name}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á:</span>
                    <span class="summary-value">${summary.sub_job_type_name}</span>
                </div>
                ${noteFilterHtml}
                <div class="summary-item">
                    <span class="summary-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>
                    <span class="summary-value">${new Date(summary.report_date).toLocaleDateString('th-TH')}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î:</span>
                    <span class="summary-value">${generatedAt}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°:</span>
                    <span class="summary-value">${summary.total_count}</span>
                </div>
            `;

            document.getElementById('reportSummary').style.display = 'block';

            // Display details
            const detailsContent = document.getElementById('detailsContent');
            
            if (reportData.length === 0) {
                detailsContent.innerHTML = '<div class="no-data">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>';
            } else {
                let detailsHtml = '';
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                const sortedData = reportData.sort((a, b) => new Date(b.scan_date) - new Date(a.scan_date));
                const limitedData = sortedData.slice(0, 100);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏¥‡∏ô 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                if (reportData.length > 100) {
                    detailsHtml += `<div style="text-align:center; padding:15px; background:#fff3cd; color:#856404; border-radius:5px; margin:10px 0; border-left:4px solid #ffc107;">
                        üìä ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 100 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${reportData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
                    </div>`;
                }
                
                limitedData.forEach(item => {
                    const scanTime = new Date(item.scan_date).toLocaleString('th-TH');
                    let notesHtml = '';
                    
                    if (item.notes && item.notes.trim()) {
                        notesHtml = `<div class="item-notes">üìù ${item.notes}</div>`;
                    }
                    
                    detailsHtml += `
                        <div class="report-item">
                            <div class="item-barcode">${item.barcode}</div>
                            <div class="item-details">
                                ${item.job_type_name} > ${item.sub_job_type_name} | üë§ ${item.user_id}
                            </div>
                            <div class="item-time">${scanTime}</div>
                            ${notesHtml}
                        </div>
                    `;
                });
                
                detailsContent.innerHTML = detailsHtml;
            }

            document.getElementById('reportDetails').style.display = 'block';
        }

        // Pre-load all job types and sub job types for better performance
        async function preloadAllJobData() {
            if (loadingStates.subJobTypes) {
                console.log('‚è≥ Sub job types already loading, skipping preload...');
                return;
            }
            
            loadingStates.subJobTypes = true;
            try {
                console.log('üöÄ Pre-loading job types...');
                await loadJobTypes();
                
                // Pre-load sub job types for all job types with controlled concurrency
                if (jobTypesCache.length > 0) {
                    console.log(`üì¶ Pre-loading sub job types for ${jobTypesCache.length} job types...`);
                    
                    // Limit concurrent requests to prevent log spam
                    const batchSize = 3;
                    for (let i = 0; i < jobTypesCache.length; i += batchSize) {
                        const batch = jobTypesCache.slice(i, i + batchSize);
                        const batchPromises = batch.map(async (jobType) => {
                            try {
                                const result = await fetchWithDeduplication(`/api/sub_job_types/${jobType.id}`);
                                if (result.data.success) {
                                    subJobTypesCache[jobType.id] = result.data.data;
                                    console.log(`‚úÖ Cached sub job types for ${jobType.name}: ${result.data.data.length} items`);
                                }
                            } catch (error) {
                                console.warn(`‚ö†Ô∏è Failed to pre-load sub job types for ${jobType.name}:`, error);
                            }
                        });
                        
                        await Promise.all(batchPromises);
                        
                        // Small delay between batches to reduce server load
                        if (i + batchSize < jobTypesCache.length) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                    }
                }
                console.log('‚ú® Pre-loading completed successfully!');
            } catch (error) {
                console.error('‚ùå Error during pre-loading:', error);
            } finally {
                loadingStates.subJobTypes = false;
            }
        }

        // Auth Functions
        async function checkAuthStatus() {
            try {
                const result = await fetchWithRateLimit('/api/check-auth');
                const { data } = result;
                
                if (!data.authenticated) {
                    // Redirect to login page
                    window.location.href = '/login';
                    return;
                }
                
                // Show user info if available
                if (data.username) {
                    document.getElementById('userInfo').textContent = `üë§ ${data.username}`;
                }
                
            } catch (error) {
                console.error('Error checking auth status:', error);
                window.location.href = '/login';
            }
        }

        async function logoutUser() {
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                return;
            }
            
            try {
                await fetchWithRateLimit('/api/logout', {
                    method: 'POST'
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            
            // Redirect to login page
            window.location.href = '/login';
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            checkAuthStatus();
            
            // Pre-load all job data for instant access
            preloadAllJobData();
            
            // ‡πÅ‡∏™‡∏î‡∏á default scan status ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
            showDefaultScanStatus();
            
            // Load initial data with delay to prevent race conditions
            setTimeout(() => {
                loadHistory();
            }, 100);
            
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reportDate').value = today;
            
            // ‡∏õ‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const barcodeInput = document.getElementById('barcode');
            const noteTextarea = document.getElementById('note');
            barcodeInput.disabled = true;
            barcodeInput.placeholder = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type ‡∏Å‡πà‡∏≠‡∏ô';
            noteTextarea.disabled = true;
            noteTextarea.placeholder = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Job Type ‡∏Å‡πà‡∏≠‡∏ô';
            

        });
    </script>
        </div> <!-- Close content -->
    </div> <!-- Close container -->

    <!-- Modal Notification -->
    <div id="modal-notification" class="modal-notification-overlay" style="display:none;">
        <div class="modal-notification-content">
            <span class="modal-notification-icon"></span>
            <h3 class="modal-notification-title"></h3>
            <p class="modal-notification-message"></p>
            <button class="modal-notification-close-btn">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</button>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-notification-container"></div>
</body>
</html> 